name: Build

on: [push, pull_request]

jobs:
  build:
    runs-on: [ ubuntu-latest,windows-latest,macos-latest ]
    steps:
    - uses: actions/checkout@v3

    - uses: ruby/setup-ruby@v1
      with:
        ruby-version: 3.2.2

    - name: Set up environment
      run: bundle install

    - name: Build
      run: bundle exec rake package

    - name: test package
      if: ${{ runner.os == 'Linux'}}
      run: |
        cd pkg
        tar xvf *linux-x86_64.tar.gz
        ./pact/bin/pact
    - name: test package
      if: ${{ runner.os == 'MacOD'}}
      run: |
        cd pkg
        tar xvf *osx-x86_64.tar.gz
        ./pact/bin/pact
    - name: test package
      if: ${{ runner.os == 'Windows'}}
      run: |
        cd pkg
        tar -xf *win32.zip
        .\pact\bin\pact.bat
